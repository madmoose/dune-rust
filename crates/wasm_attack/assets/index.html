<!doctype html>
<html lang="en-US">

<head>
	<meta charset="utf-8" />
	<title>WASM Dune Night Attack</title>
	<link rel="preconnect" href="https://rsms.me/">
	<link rel="stylesheet" href="https://rsms.me/inter/inter.css">
	<style>
		:root {
			font-family: Inter, sans-serif;
			font-feature-settings: 'liga' 1, 'calt' 1;
			font-variant-numeric: tabular-nums;
			/* fix for Chrome */
		}

		@supports (font-variation-settings: normal) {
			:root {
				font-family: InterVariable, sans-serif;
			}
		}

		[v-cloak] {
			display: none !important;
		}

		html,
		body {
			background-color: #111;
			color: #000;
			max-width: 48rem;
			margin-left: auto;
			margin-right: auto;
			font-size: 0.875rem;
			line-height: 1.5rem;
		}

		@media (min-width: 1440px) {

			html,
			body {
				max-width: 96rem;
				/* background-color: red; */
			}
		}

		#app {
			display: flex;
			flex-direction: column;
			justify-content: center;
			gap: 1rem;
		}

		@media (min-width: 1440px) {
			#app {
				flex-direction: row;

				&>div {
					width: 50%;
				}
			}
		}

		canvas {
			display: block;
			margin: auto;
			width: 100%;
			max-width: 48rem;
			image-rendering: -moz-crisp-edges;
			image-rendering: -webkit-crisp-edges;
			image-rendering: pixelated;
			aspect-ratio: 4 / 3;
		}
	</style>
	<script type="importmap">
		{
		  "imports": {
			"vue": "https://unpkg.com/vue@3/dist/vue.esm-browser.prod.js"
		  }
		}
	</script>
	<script type="module">
		import { createApp, ref } from 'vue'
		import init, { AttackRenderer } from "./pkg/wasm_dune_attack_$hash.js";

		await init();

		createApp({
			setup() {
				return {
					canvas: null,
					attack_renderer: null,
				}
			},
			mounted() {
				this.canvas = document.querySelector('canvas');
				this.attack_renderer = new AttackRenderer(canvas);
				this.randomize()
			},
			methods: {
				randomize() {
					let values = new Uint16Array(3);
					crypto.getRandomValues(values);

					this.attack_renderer.set_rand_bits(values[0]);
					this.attack_renderer.set_rng_seed(values[1]);
					this.attack_renderer.set_masked_rng_seed(values[2]);
				}
			}
		}).mount('#app')
	</script>
</head>

<body>
	<div id="app" v-cloak>
		<div>
			<canvas id="canvas" width="320" height="200"></canvas>
		</div>
	</div>
</body>

</html>
